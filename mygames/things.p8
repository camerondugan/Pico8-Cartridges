pico-8 cartridge // http://www.pico-8.com
version 32
__lua__
--lift by cameron dugan
								
function _init()
	--room state
	boxes={{x=50,y=25,sx=10,sy=17,pushable=true},{x=6,y=5,sx=10,sy=10,pushable=true},{x=37,y=37,sx=8,sy=8,pushable=true}}
	
	--player state
	p={}
	p.x=80
	p.y=80
	p.sx=10
	p.sy=20
	speed=1 //don't change speed
									//kinda broken
	--timers
	last_step=-1
end
	
--draw
function _draw()
	cls()
	--border
	rect(1,1,125,125,3)
	foreach(boxes,draw_box)
	--tmp code
	//foreach(boxes,push)
	--draw player
	rectfill(p.x,p.y,p.x+p.sx,p.y+p.sy,13)
	--debug variables (print stuff)
end

function draw_box(b)
	--body
	rect(b.x,b.y,b.x+b.sx,b.y+b.sy,4)
	rectfill(b.x+1,b.y+1,b.x+b.sx-1,b.y+b.sy-1,15)
	--wood bars
	line(b.x,b.y,b.x+b.sx,b.y+b.sy,4)
	line(b.x+b.sx,b.y,b.x,b.y+b.sy,4)
	--metal corners
	pset(b.x,b.y,5)
	pset(b.x+b.sx,b.y)
	pset(b.x,b.y+b.sy)
	pset(b.x+b.sx,b.y+b.sy)
end

--✽ speedy updating ✽
function _update60()
	boxcol=false
	get_input()
	foreach(boxes,push)
	move()
end

--input
function get_input()
	dx=0
	dy=0
	if (btn(0))	dx-=speed
	if (btn(1))	dx+=speed
	if (btn(2)) dy-=speed
	if (btn(3))	dy+=speed
	-- play sound if moving
	if (abs(dx)+abs(dy)>0)	then
		step_sound()
	end
end

-- player 😐 movement
function move()
	if not collides(boxes,dx,dy) then
		p.x+=dx
		p.y+=dy
	end
end

-- play step sound
function step_sound()
	this_step=t()
	if (this_step - last_step > 0.5) then
		sfx(0)
		last_step=t()
	end
end
-->8
--hard game rules

--collision section
function collides(boxes,dx,dy)
	--update potential positions
	px=p.x+dx
	py=p.y+dy
	--wall collision
	if (py<2 or py>124)	return true
	if (px<2 or px>124)	return true
	if (py+p.sy<2 or py+p.sy>124)	return true
	if (px+p.sy<2 or px+p.sx>124)	return true
	--box collision
	boxcol=false
	foreach(boxes,boxcollides)
	if (boxcol)	return true
	return false
end

function boxcollides(b)
	for sx=0,p.sx,1 do
		for sy=0,p.sy,1 do
			if (px+sx>=b.x and px+sx<=(b.x+b.sx)) then
				if (py+sy>=b.y and py+sy<=(b.y+b.sy)) then
					boxcol=true
					return
				end
			end
		end
	end
end

--occupency section
function box_occupied(ex,ey)
	for b in all(boxes) do
		if ex>=b.x and ex<=(b.x+b.sx) then
			if ey>=b.y and ey<=(b.y+b.sy) then
				return true
			end
		end
	end
	return false
end

function player_occupied(ex,ey)
	if ((ex>=p.x and ex<=p.x+p.sx) and (ey>=p.y and ey<=p.y+p.sy)) then
		return true
	end
	return false
end

function occupied(ex,ey)
	if (box_occupied(ex,ey)) return true
	if (player_occupied(ex,ey)) 	return true
	if ((ex<=1 or ex>124) or (ey<=1 or ey>124)) return true
	return false
end

-- misc game rules
function push(b)
	pushed=false
	if (not b.pushable) return false
	--pushed right
	for i = 0, b.sy, 1 do --right box pixel
		--if player is pushing right
		--and next to object
		if (dx>0 and player_occupied(b.x-speed,b.y+i)) then
			should_move=true
			for k=0, b.sy, 1 do
				if occupied(b.x+b.sx+speed,b.y+k) then
					should_move=false
				end
			end
			if (should_move) b.x+=dx
			if (should_move) pushed=true
		end
	end
	--pushed left
	for i=0,b.sy,1 do --right box pixels
		--if player is pushing
		if (dx<0 and player_occupied(b.x+b.sx+speed,b.y+i)) then
			should_move=true
			for k=0, b.sy, 1 do
				if occupied(b.x-speed,b.y+k) then
					should_move=false
				end
			end
			if (should_move) b.x+=dx
			if (should_move) pushed=true
		end
	end
	--detect top
	for i = 0, b.sx, 1 do --box width
		--if player is pushing
		if (dy>0 and player_occupied(b.x+i,b.y-speed)) then
			should_move=true
			for k=0, b.sx, 1 do
				if occupied(b.x+k,b.y+b.sy+speed) then
					should_move=false
				end
			end
			if (should_move) b.y+=dy
			if (should_move) pushed=true
		end
	end
	--detect bottom
	for i = 0, b.sx, 1 do
		if (dy<0 and player_occupied(b.x+i,b.y+b.sy+speed)) then
			should_move=true
			for k=0, b.sx, 1 do
				if occupied(b.x+k,b.y-speed) then
					should_move=false
				end
			end
			if (should_move) b.y+=dy
			if (should_move) pushed=true
		end
	end
	if (pushed) sfx(1)
end
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__label__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
03333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000005444444444500000000000000000000000000000000000000000000000000000000000000000000000000300
030000000000000000000000000000000000000044fffffff4400000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000004f4fffff4f400000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000004ff4fff4ff400000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000004fff4f4fff400000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000004ffff4ffff400000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000004fff4f4fff400000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000004ff4fff4ff400000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000004f4fffff4f400000000000000000000000000000000000000000000000000000000000000000000000000300
030000000000000000000000000000000000000044fffffff4400000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000005444444444500000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000054444444445000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000044fffffff44000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000044fffffff44000000000000000000000000000000000300
0300000000000000000000000000000000000000000000000000000000000000000000000000000004f4fffff4f4000000000000000000000000000000000300
0300000000000000000000000000000000000000000000000000000000000000000000000000000004f4fffff4f4000000000000000000000000000000000300
0300000000000000000000000000000000000000000000000000000000000000000000000000000004ff4fff4ff4000000000000000000000000000000000300
0300000000000000000000000000000000000000000000000000000000000000000000000000000004fff4f4fff4000000000000000000000000000000000300
0300000000000000000000000000000000000000000000000000000000000000000000000000000004fff4f4fff4000000000000000000000000000000000300
0300000000000000000000000000000000000000000000000000000000000000000000000000000004ffff4ffff4000000000000000000000000000000000300
0300000000000000000000000000000000000000000000000000000000000000000000000000000004ffff4ffff4000000000000000000000000000000000300
0300000000000000000000000000000000000000000000000000000000000000000000000000000004fff4f4fff4000000000000000000000000000000000300
0300000000000000000000000000000000000000000000000000000000000000000000000000000004fff4f4fff4000000000000000000000000000000000300
030000000000000000000000000000000000000000000000000000000000000000000000000000ddd4ff4fff4ff4000000000000000000000000000000000300
030000000000000000000000000000000000000000000000000000000000000000000000000000ddd4f4fffff4f4000000000000000000000000000000000300
030000000000000000000000000000000000000000000000000000000000000000000000000000ddd4f4fffff4f4000000000000000000000000000000000300
030000000000000000000000000000000000000000000000000000000000000000000000000000ddd44fffffff44000000000000000000000000000000000300
030000000000000000000000000000000000000000000000000000000000000000000000000000ddd44fffffff44000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000054444444445000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000005444444450000000000000000000000000000000000000000000000000000000000000000000000000000000300
030000000000000000000000000000000000044fffff440000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000004f4fff4f40000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000004ff4f4ff40000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000004fff4fff40000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000004ff4f4ff40000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000004f4fff4f40000000000000000000000000000000000000000000000000000000000000000000000000000000300
030000000000000000000000000000000000044fffff440000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000005444444450000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
03333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333300
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

__sfx__
001600000301002010010000c0000e00010000110000c0000e00010000110000c0000e00010000110000c0000e00010000110000c0000e00010000110000c0000e00010000110000c0000e00010000110000c000
000500000902009020090100901000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__music__
00 01424344

